# コマンドパレット Notion拡張機能 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**CmdPal-FastNotion**

### 1.2 目的
PowerToysの**コマンドパレット（Command Palette）**から、`memo [内容]`というコマンド形式でNotionの特定データベースに素早くメモを作成する拡張機能を開発する。VS Codeのコマンドパレットのように、高速で多機能なコマンド実行体験をWindows OS全体で実現することを目的とする。

### 1.3 ユーザーストーリー
「開発者として、アイデアや重要な情報をすぐにメモしたいが、Notionを開いてページを作成するのは時間がかかる。コマンドパレットからワンコマンドでメモを作成したい。」

## 2. 機能要件

### 2.1 基本機能
1. **メモ作成コマンド**
   - コマンド形式：`memo [メモ内容]`
   - 例：`memo 明日の会議でAPI設計について議論する`
   - Notionの指定されたデータベースに新しいページとして追加する。

2. **レスポンス表示**
   - コマンドパレットの結果ペインに、成功・失敗メッセージを表示する。
     - 成功時：「✓ Notionメモを作成しました」
     - 失敗時：「⚠ メモの作成に失敗しました：[理由]」
   - 成功時にNotionページのURLをクリップボードに自動コピーする（オプション）。

3. **設定機能**
   - コマンドパレットのUI内で、対話的に設定を行えるようにする。
   - `notion-config`のようなコマンドで設定ページを呼び出す。
   - 設定項目：
     - Notionインテグレーションシークレット
     - 対象データベースID

### 2.2 詳細仕様

#### 2.2.1 入力仕様
- **起動方法**: `Win + Alt + Space` → `memo [内容]`
- **文字数制限**: 最大500文字（Notion API制限内）

#### 2.2.2 Notion連携仕様
- **ページタイトル**: 入力されたメモ内容全体をそのまま設定。
- **設定するプロパティ**:
  - **タイトル**（Title）: 入力されたメモ内容
  - **タスク種別**（Select）: "📝CmdPalメモ" 固定値
- **自動設定されるプロパティ**:
  - **作成日時**（Created time）: Notion側で自動設定。

## 3. 技術要件

### 3.1 開発環境
- **開発言語**: C#
- **ターゲットプラットフォーム**: Windows App SDK
- **開発ツール**: Visual Studio 2022
- **拡張モデル**: PowerToys Command Palette Extension SDK (WinRTベース)

### 3.2 実装アーキテクチャ
- **プロセス**: アウトオブプロセスCOMサーバーとして動作。
- **実装クラス**: `FastNotionCommandsProvider` クラスにコマンドロジックを実装。
- **登録**: `app.manifest` ファイルで拡張機能をシステムに登録。

### 3.3 ファイル構成
- PowerToysコマンドパレット拡張機能の公式テンプレートに準拠する。
  - `CmdPal-FastNotion.sln`
  - `CmdPal-FastNotion/`
    - `CmdPal-FastNotion.csproj`
    - `Package.appxmanifest`
    - `FastNotionCommandsProvider.cs`
    - `NotionApiClient.cs`
    - `Assets/`

## 4. UI/UX要件

### 4.1 実行時UI
- コマンドパレットの標準UI（リスト＆詳細ペイン）を活用する。
- 結果表示には、アイコン、タイトル、サブタイトルを使用して分かりやすく表示する。

### 4.2 設定UI
- 将来的に、Adaptive Cardsを用いてリッチな設定UIをコマンドパレット内に直接レンダリングすることを検討する。
- MVP段階では、設定コマンド実行時に外部設定ファイル（JSON形式）をテキストエディタで開かせるシンプルな方式も可とする。

## 5. 配布・インストール要件

### 5.1 配布形式
- **WinGet** パッケージとして配布することを第一目標とする。
- または、**Microsoft Store**経由での配布も検討する。
- これにより、ユーザーはコマンドパレット内から直接インストール可能になる。

### 5.2 インストール手順
1. コマンドパレットから `winget install CmdPal-FastNotion` を実行。
2. 拡張機能が自動で認識される。
3. `notion-config` コマンドで初期設定を行う。

## 6. 今後の拡張可能性
- **複数データベース対応**: `memo.work [内容]` のように、プレフィックスで保存先DBを切り替えられるようにする。
- **動的プロパティ指定**: `memo [内容] #tag @project` のような自然言語に近い形式でプロパティを指定できるようにする。
- **フォーム入力**: コマンドパレットのフォーム入力機能を活用し、複数行のメモや詳細なプロパティを対話形式で入力できるようにする。
- **検索機能**: `notion-search [キーワード]` で既存のメモを検索・表示できるようにする。

## 7. 開発スケジュール（想定）

### Phase 1: MVP実装 (3-4週間)
- [ ] コマンドパレット拡張機能プロジェクトのセットアップ
- [ ] `memo [内容]` コマンドの基本実装
- [ ] Notion API連携（ページ作成）の実装
- [ ] 基本的なエラーハンドリング
- [ ] 設定ファイル（JSON）を手動編集する形での設定機能

### Phase 2: 設定機能と配布 (追加2週間)
- [ ] `notion-config` コマンドによる対話的設定機能の実装
- [ ] WinGetへのパッケージ公開準備
- [ ] 第1回公式リリース

---
この要件定義書に基づき、コマンドパレット拡張機能として開発を進めます。
